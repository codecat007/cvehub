## Description

A remote code execution vulnerability in libjpeg(the affected version is 4.4.4, 5.0.2, 5.1.1). It could occur while decompressing a specially crafted file.

http://androidxref.com/5.1.1_r6/xref/external/jpeg/jmemmgr.c#648
http://androidxref.com/5.1.1_r6/xref/external/jpeg/jmemmgr.c#672
```cpp
GLOBAL(void)
jpeg_open_backing_store (j_common_ptr cinfo, backing_store_ptr info,
	long total_bytes_needed);

jpeg_open_backing_store(cinfo, & bptr->b_s_info,
	(long) bptr->rows_in_array *
	(long) bptr->blocksperrow *
	(long) SIZEOF(JBLOCK));
```
This function uses ashmem to get a shared memory of total\_bytes\_needed,  by controling the value of bptr->rows\_in\_array and bptr->samplesperrow, the size can greater than 2^32 and suddenly integer overflow occur.

## Poc

djpeg -color 256 CVE-2016-6702
